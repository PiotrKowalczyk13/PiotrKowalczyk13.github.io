<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        canvas {
            border: 1px solid #d3d3d3;
            background-color: #f1f1f1;
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
    </style>
</head>
<body onload="startGame()">
    <script src="Objects.js"></script>
    <script src="Controls.js"></script>
    <script src="Stats.js"></script>
    <script src="Rules.js"></script>
    <script src="Collisions.js"></script>
    <script>

        var player;
        var horizontalPlatform;
        var myBallArray = [];
        var tilesArray = [];
        let ctx;
        var background = new Image();

        var lowest = 150;
        var countB = 0;
        var verticalPlatform = null;
        var mode = false;
        var block;
        var bonusArray = [];
        var isX2Active = false;
        var x2Timer;
        var isX5Active = false;
        var x5Timer;
        var startingSize;
        var isSizeUpgrActive = false;
        var sizeUpgrTimer;
        var isSizeDwngrActive = false;
        var sizeDwngTimer;
        var isDirectionsActive = false;
        var dirTimer;

        var score = 0;
        var time;

        var tempBallSpeedX = [];
        var tempBallSpeedY = [];
        var keyPressed = false;
        var gamePaused = false;

        function startGame() {
            background.src = "background.jpg";
            document.getElementById('buttons').style.display = 'none';
            player = "User";

            if (confirm("Do you want additional layers of tiles showing up or should tiles just fill the gaps?")) {
                mode = true;
            }

            if (confirm('Do you want second, vertical platform?')) {
                verticalPlatform = new platformVertical(23, 128, 0, 300);
                document.getElementById('upButton').style.display = 'none';
                document.getElementById('downButton').style.display = 'none';
            }
            else {
                document.getElementById('upButton').style.display = 'none';
                document.getElementById('downButton').style.display = 'none';
            }
            time = 0;
            horizontalPlatform = new platformHorizontal(128, 23, 256, 457);
            startingSize = horizontalPlatform.width;
            myBallArray.push(new ball());
            let counter = 0;
            for (let i = 50; i < 130; i = i + 21) {
                for (let j = 65; j < 575; j = j + 51) {
                    tilesArray.push(new tile(j, i));
                    counter++;
                }
            }
            myGameArea.start();
            pause();
        }

        var myGameArea = {
            canvas: document.createElement("canvas"),
            start: function () {
                this.canvas.width = 640;
                this.canvas.height = 480;
                this.context = this.canvas.getContext("2d");
                document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                this.interval = setInterval(updateGameArea, 20);
                this.timerInterval = setInterval(timer, 1000);
                window.addEventListener('keydown', function (e) {
                    myGameArea.key = e.keyCode;
                    keyPressed = true;
                })
                window.addEventListener('keyup', function (e) {
                    myGameArea.key = false;
                })
            },
            clear: function () {
                this.context.globalAlpha = 0.4;
                this.context.drawImage(background, 0, 0);
                this.context.globalAlpha = 1;
            }
        }

        function updateGameArea() {
            myGameArea.clear();
            if (myGameArea.key) {
                if (myGameArea.key == 37) { moveleft(); }
                if (myGameArea.key == 39) { moveright(); }
                if (myGameArea.key == 38) { moveup(); }
                if (myGameArea.key == 40) { movedown(); }
            }
            else {
                if (keyPressed) {
                    clearmove();
                    keyPressed = false;
                }
            }
            checkObjectsCollision();
            addBall();
            checkForActiveBonus();
            checkBonusTimers();
            deleteBall();
            gamemodeRules();
            displayScore();
            displayTime();
            if (myBallArray.length <= 0) {
                gameOver();
            }
            if (gamePaused) {
                horizontalPlatform.speedX = 0;
                if (verticalPlatform) {
                    verticalPlatform.speedY = 0;
                }
                myGameArea.context.font = (myGameArea.context.canvas.width / 16).toString() + "px Helvetica";
                myGameArea.context.textAlign = "center";
                myGameArea.context.fillStyle = "white";
                myGameArea.context.fillText("Game is paused", myGameArea.canvas.width / 2, myGameArea.canvas.height / 2 - 20);
                myGameArea.context.fillText("Press start", myGameArea.canvas.width / 2, myGameArea.canvas.height / 2 + 20);
            }
        }

        function openForm() {
            document.getElementById("myForm").style.display = "block";
        }

        function closeForm() {
            document.getElementById("myForm").style.display = "none";
        }

    </script>
    <div style="font-size: large; text-align:center;">
        SCORE: <span id="displayCurrentScore">0</span>
    </div>
    <div style="font-size: large; text-align:center;">
        TIME: <span id="displayGameTime">0</span>
    </div>
    <div style="text-align:center;width:auto;" id="upButton">
        <button style="width: 100px" onmousedown="moveup()" onmouseup="clearmove()" ontouchstart="moveup()">UP</button>
    </div>
    <div style="text-align:center;width:auto;" id="buttons">
        <button style="width: 100px" onmousedown="moveleft()" onmouseup="clearmove()" ontouchstart="moveleft()">LEFT</button>
        <button style="width: 100px" onmousedown="moveright()" onmouseup="clearmove()" ontouchstart="moveright()">RIGHT</button>
    </div>
    <div style="text-align:center;width:auto;" id="downButton">
        <button style="width: 100px" onmousedown="movedown()" onmouseup="clearmove()" ontouchstart="movedown()">DOWN</button>
    </div><br><br>
    <div style="text-align:center;width:auto;">
        <button style="width: 100px" onclick="pause()">PAUSE</button>
        <button style="width: 100px" onclick="start()">START</button><br><br>
    </div><br><br>
    <div style="text-align:center;width:auto;" id="showStats">
        <button style="width: 100px" onclick="showStats()">STATS</button>
    </div>
</body>
</html>
